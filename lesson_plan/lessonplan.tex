\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx,wrapfig}
\usepackage{textcomp}
\usepackage{subcaption}
\usepackage{geometry}
\usepackage{amsmath}
\usepackage{apacite}
\usepackage{array}
\usepackage[table]{xcolor}
\usepackage{float}
\usepackage{amssymb}
\usepackage{fancyhdr}
\usepackage{listings}
\usepackage{xcolor} 
\usepackage[font=tiny,labelfont=bf]{caption}

\floatstyle{plaintop}
\restylefloat{table}
\renewcommand{\arraystretch}{1.8}

\title{Lesson Planner}
\author{GIS Outreach 2021}
\date{Sophie Kolston (she/her)}

\begin{document}

\maketitle

\tableofcontents

\setlength{\parindent}{0in} 
\newgeometry{top=2.5cm, bottom=3cm, left=2.5cm, right=2.5cm}


\section{Lesson Objectives}
\subsection{Introduction}
This document serves as a lesson planner for myself and hopefully others. This lesson planner is free for anyone to use with no restrictions, including in a commercial capacity (this does NOT include the data provided). The purpose of the lessons is to introduce the unfamiliar to a GIS environment. We have chosen to use ArcMap (reluctantly, thanks to its ease of use for beginners), but the simple tools and concepts mean this could be delivered using a variety of geospatial applications.

\subsection{Target Audience}
Lessons have been written for a community outreach program aimed at getting more GIS education in high school. The idea is to teach high school teachers the basics of GIS so that they can teach it to their students at varying levels. How well this will work, we don't know. Ideally we at least want to bring the awareness of GIS into high schools as geography teachers were often trained before it become as ubiquitous as it is today. My concern is that most high school teachers focus on social geography where GIS papers were not a priority, so they will not deliver its importance to their students. Hopefully lessons like this can help. \\

With all that being said, these lessons cover the very basics that would be expanded on in a first-year GIS course, so would also be useful to complete by keen students. The teacher should be able to complete the tasks in the lessons once or twice to be equipped to deliver it as a formal class.

\subsection{Rote Lesson Objectives}
These lessons are hopefully crafted in such a way that attendees should leave with the following abilities:
\begin{enumerate}
	\item Understand common GIS file types and ways analysts use to manage said files
	\item The ability to produce digital maps, obeying standard mapping conventions
	\item Use simple geoprocessing tools to analyse an area
	\item Understand the basics of Vector and Raster data
	\item Have the ability to deliver such a lesson to intermediate/high school students
\end{enumerate}
\pagebreak

\section{Part 1: Introduction to a GISystem and Cartography}
\subsection{Preamble}
In part 1, students will digitise the extent, and crater, of Mt Taranaki. They will manipulate some contextual data and then export their map with mapping conventions. \\

This lesson will cover the basic data types we deal with in GIS and how to present them. There will be an introduction to vector and raster data with some tools used in geospatial analysis. I would consider the main part of this lesson to be the understanding of how to get data on to ArcMap and how to display it. Folder connection, geodatabases and so on are needlessly confusing, so it is good to dedicate some time to it all. 

\subsection{Data Overview}
The data for this section is as basic as it gets. If the students like, it would be great for them to obtain their own data to place in the map background - just something basic to cover the concept of data wrangling. For now, we will assume they only have what is provided. All data contained in the lesson are pre-converted to NZGD 2000 (EPSG:2193), and are cropped to the Taranaki Regional Council boundary. 

\begin{table}[h]
\begin{center}
    \begin{tabular}{ | m{4cm} | m{1cm}| m{3.5cm} | m{5cm} | m{1cm} | } 
    \hline
    \cellcolor{red!35!blue!33!green!33!}\textbf{Name/Description} & 
    \cellcolor{red!35!blue!33!green!33!}\textbf{Size} &
    \cellcolor{red!35!blue!33!green!33!}\textbf{Source} &
    \cellcolor{red!35!blue!33!green!33!}\textbf{Learning Objective(s)} &
    \cellcolor{red!35!blue!33!green!33!}\textbf{ID} \\
    \hline
    ArcMap basemap & N/A & ESRI (within ArcMap) & Cartography (context) & 10 \\
    \hline
    NZ primary land parcels & 5MB & LINZ & Vector symbology, cartography & 11 \\
    \hline
    NZ road section geometry & 1MB & LINZ & Cartography (context) & 12 \\
    \hline
    \end{tabular}
\end{center}
\caption{\label{tb_data_1}Data used for Part 1}
\end{table}

\subsection{Instructions}
The first step that we will go through is creating a Folder GeoDatabase for the project. Launch ArcMap, then select File $>$ Save. For this example, we can just save to the Desktop. To access the Desktop folder we will first need to create a folder connection to this directory. Folder connections are ways that ArcMap can create catalogues of available data. Go to File $>$ Add Data $>$ Add Data. Click `New Folder Connection' (see Figure \ref{folderconnection}), then navigate to your data folder. Make sure that the data files are extracted from their zip archives. Select the land parcel and road section data, then select `Add'. \\

\begin{figure}[h]
  \centering
  \caption{Creating a folder connection}
  \includegraphics[width=300px]{images/part1/folderconnection.PNG}
  \label{folderconnection}
\end{figure}

The data should now be on the current data frame, and should look something like Figure \ref{rawdata}. We can't really display much information here without showing some background information so that the viewer of the map knows where this is spatially. Select File $>$ Add Data $>$ Add Basemap, and select `NZ Imagery'. We now have imagery of the environment, where it is obvious that we are looking at the Taranaki peninsula. The small checkbox next to each layer of data can enable or disable it.\\

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Our raw data displayed}
    \includegraphics[width=250px]{images/part1/rawdata.PNG}
    \label{rawdata}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Creating a new shapefile}
    \includegraphics[width=150px]{images/part1/newshp_catalog.PNG}
    \label{newshp_catalog}
  \end{minipage}
\end{figure}

Imagine we have been instructed to digitise the basic geographical features of Mt. Taranaki. To do this, we will draw a polygon around the forested area, as well as a point for the centre point of the mountain. We will need to create a new shapefile to save this data into - select `Catalog' to the right of the screen (see Figure \ref{newshp_catalog}), right click on the folder you would like to save it in $>$ New $>$ Shapefile. Set a relevant name, see Figure \ref{newshp_featurename} for mine, then make the type `Polygon'. Ignore spatial reference for now (as well as the error that will come up). The new file should appear on your list of layers. To add features, we can enable the editing toolbar by clicking Customize $>$ Toolbars $>$ Editor. On the new toolbar that has appeared, click Editor $>$ Start Editing. Select the shapefile you just created (see Figure \ref{newshp_startediting}), then go back to the toolbar and select `Create Features'. We can once again select the shapefile in the new window that has appeared (see Figure \ref{newshp_createfeatures}), and we are finally ready to draw the polygon! Each click with the mouse adds a new vertex to the polygon, and a double-click will end the editing. Draw around the forested area that surrounds Mt. Taranaki (see Figure \ref{newshp_drawingpolygon}), then on the Editor toolbar select Editor $>$ Stop Editing.\\

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Setting the name and type of our new shapefile}
    \includegraphics[width=130px]{images/part1/newshp_featurename.PNG}
    \label{newshp_featurename}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Selecting the file to edit}
    \includegraphics[width=150px]{images/part1/newshp_startediting.PNG}
    \label{newshp_startediting}
  \end{minipage}
\end{figure}
\pagebreak
\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Creating features under the editor toolbar}
    \includegraphics[width=250px]{images/part1/newshp_createfeatures.PNG}
    \label{newshp_createfeatures}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Drawing a polygon around Taranaki}
    \includegraphics[width=150px]{images/part1/newshp_drawingpolygon.PNG}
    \label{newshp_drawingpolygon}
  \end{minipage}
\end{figure}

You should now have a freshly created polygon that covers the extent of Mt. Taranaki. Now follow the same steps on another shapefile, but this time with a `Point' feature type - this will be the crater centre. Note that you might want to untick the polygon in order to see the imagery so that you can judge where the crater will be.\\

\begin{figure}[h]
    \centering
    \caption{Changing the symbology of a layer}
    \includegraphics[width=300px]{images/part1/symbology}
    \label{symbology}
\end{figure}

You have successfully created a simple digitisation of a geographic feature. The work in its current form, as an ArcMap project, is not very approachable. Let's create a map so that we can present it. Firstly, we want to add some layers of data for content - these will be the road section and land parcel data we imported earlier. On the roads, right click and select `Properties'. Go to `Symbology' then select the symbol (see Figure \ref{symbology}) and increase the width to 1, with the colour as black. Click `Apply' to save the changes, then close the window and go to the same symbology properties, this time of the land parcel layer. We are going to colour the land parcels based on what type of land they are. To do this, select Categories $>$ Unique Values with the value field as `parcel\_int' (see Figure \ref{symbology_uniquevalues}). This symbology method will colour areas based on a value of an attribute, in this case the use of the land parcel. Select whichever colour ramp you like, save and apply the changes.\\

Next, change the colours and sizing of the extent polygon and crater point so that they are more visible. An important part of cartography is choosing what should be displayed and how - we want a comprise of delivering the most data we can whilst not overwhelming the viewer.
\pagebreak

Lastly, let's adjust the transparency of the land parcels so that we can have a sense of the size and what the features look like underneath. Enable the `Effects' toolbar the same way you did for Editor. Select the land parcel layer in the dropdown (see Figure \ref{transparency}) and increase the transparency to the point where you can see the terrain underneath, but retain the information conveyed by the symbology.\\

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.5\textwidth}
    \centering
    \caption{Symbolising our features based on unique values of an attribute}
    \includegraphics[width=200px]{images/part1/symbology_uniquevalues.PNG}
    \label{symbology_uniquevalues}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Adjusting transparency settings}
    \includegraphics[width=150px]{images/part1/transparency.PNG}
    \label{transparency}
  \end{minipage}
\end{figure}

The processing of data is complete, we are ready to design the map. Select `Layout View' on the bottom left of the map frame (see Figure \ref{layoutview}). Change the page size to A4 landscape by selecting Change Layout $>$ ISO Page Sizes $>$ A4 Landscape (see Figure \ref{layout_changesize}). You can see we now have zoom and pan controls for both the data frame and layout frame. The new controls that have just appeared will control what part of the layout you are looking at, not the data that is displayed. Using `Insert' along the top, add a title and north arrow. I would recommend spending some time looking into the various formatting settings you can make, such as text wrapping and alignment for the title (hint: double-click on the title after creating it). \\

\begin{figure}[h]
  \centering
  \caption{Selecting the Layout view}
  \includegraphics[width=400px]{images/part1/layoutview}
  \label{layoutview}
\end{figure} \pagebreak

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.5\textwidth}
    \centering
    \caption{Changing the page size of the layout view}
    \includegraphics[width=200px]{images/part1/layout_changesize.PNG}
    \label{layout_changesize}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Inserting a legend}
    \includegraphics[width=180px]{images/part1/layout_legend.PNG}
    \label{layout_legend}
  \end{minipage}
\end{figure}

Next, let's add a legend so that the reader can see what the colours of the land parcels and our added features represent. Insert $>$ Legend will launch the Legend Wizard. Add all of the layers to be included in the legend (see Figure \ref{layout_legend}), then continue through the wizard leaving everything at default settings. Out will pop up a large legend with a lot of issues. The legend designer for ArcMap is not great, so we can just modify everything manually by converting the legend to a graphics item that can be manipulated with ease. Right-click on the newly created legend then select `Convert to Graphics', then right-click again the select `Ungroup'. You can now go through and make precise modifications to the legend where need be. Further ungrouping items will let you double-click on text items to rename them. I have gone through and changed the name of my created polygons, as well as removing legend items that are not discernible - it is all up to your judgement.\\

\begin{figure}[h]
    \centering
    \caption{Inserting a scale bar}
    \includegraphics[width=250px]{images/part1/layout_scalebar.PNG}
    \label{layout_scalebar}
\end{figure}

The last cartographic element required is the scale. This shows the distance on the ground relative to the distance on the map, and is an extremely important spatial reference. Insert $>$ Scale Bar will give a lot of design choices, go with whatever you like. Before inserting it, make sure it is in metric and you'll probably want kilometres as a scale reference given the area we are interested in (see Figure \ref{layout_scalebar}).\\

Click File $>$ Export Map and save the map as a .png with a dpi of 300. Figure \ref{example_part1} shows my final map, which should look along the same lines as yours. Congratulations! You have learnt how to add data and present it in a meaningful way spatially.

\begin{figure}[h]
    \centering
    \caption{An example final map for part 1}
    \includegraphics[width=500px]{images/part1/sophie_part1.png}
    \label{example_part1}
\end{figure}

\subsection{FAQ/Common Mistakes}
\begin{itemize}
    \item Make sure the `Spatial Analyst' extension is enabled. Toolbar $>$ Customize $>$ Extensions
    \item Error 999999... Make sure you have no spaces in your file names. I suggest employing `snake case', where spaces are replaced with underscores \_
\end{itemize}

\pagebreak

\section{Part 2: Vector Analysis}
\subsection{Preamble}
In part 2, students will cover the basics of vector analysis. They will work with volcano and census data in Auckland to determine the potential loss of life as the result of the awakening of the Auckland Volcanic Field. \\

The main parts to this lesson are the geoprocessing and familiarity with census data. This section will feature significantly less direct instruction and screenshots than lesson 1, as we can assume a basic understanding of the ArcMap user interface and cartographic convention.

\subsection{Data Overview}
This section will revolve around a dataset of volcanoes in Auckland. We will use census data (2018) to assess the amount of people within each level of danger. These danger levels will be arbitrarily created buffers around each volcano. A coastline dataset will be used to clip to the mainland, which will need to be converted to a polygon. \\

\begin{table}[h]
\begin{center}
    \begin{tabular}{ | m{4cm} | m{1cm}| m{3.5cm} | m{5cm} | m{1cm} | } 
    \hline
    \cellcolor{red!35!blue!33!green!33!}\textbf{Name/Description} & 
    \cellcolor{red!35!blue!33!green!33!}\textbf{Size} &
    \cellcolor{red!35!blue!33!green!33!}\textbf{Source} &
    \cellcolor{red!35!blue!33!green!33!}\textbf{Learning Objective(s)} &
    \cellcolor{red!35!blue!33!green!33!}\textbf{ID} \\
    \hline
    ArcMap basemap & N/A & ESRI (within ArcMap) & Cartography (context) & 10 \\
    \hline
    Auckland volcanoes & 1MB & Global Volcanism Program (Smithsonian) & Geoprocessing & 20 \\
    \hline
    2018 NZ Census data & 18MB & Statistics New Zealand & Geoprocessing, cartography & 21 \\
    \hline
    NZ Coastlines & 5MB & LINZ & Geoprocessing, cartography & 22 \\
    \hline
    \end{tabular}
\end{center}
\caption{\label{tb_data_2}Data used for Part 2}
\end{table}

\subsection{Instructions}
As always, the first step is to download and load all the data required. Add a folder connection as with lesson 1, then load the volcanoes, census data and coastlines. While you're at it, add your basemap of choice. Your map frame should look something like Figure \ref{2_rawdata}.

\begin{figure}[h]
  \centering
  \caption{Loading the data for lesson 2}
  \includegraphics[width=230px]{images/part2/rawdata.PNG}
  \label{2_rawdata}
\end{figure}
\pagebreak

We have the locations of volcanoes within Auckland which we are going to use to create a map of volcanic risk for the region. We are going to create a few areas around the volcano, with the closer to the volcano the higher the level of risk. We can estimate the amount of people reside within these areas using basic spatial analysis tools. First things first, let's create the areas of danger around the volcanoes. To do this, we can use the buffer tool. The buffer tool (see Figure \ref{2_volcanobuffer}) takes an input feature and creates a specified area around it, saving this area as a new feature. You can access the buffer tool by selecting the `Search' window on the right of the main window, and searching for it. The same is true for any geoprocessing tool. Create a buffer of 1000m/1km around the volcanoes layer - I named mine `volcano\_buffer\_1000m.shp'.

\begin{figure}[h]
  \centering
  \caption{Running the buffer tool}
  \includegraphics[width=270px]{images/part2/volcano_buffer.PNG}
  \label{2_volcanobuffer}
\end{figure}

The output layer of the buffer should look like Figure \ref{2_buffer_output}. We can see that there are lots of overlapping polygons, where the buffers intersect one another. This can be remedied with the dissolve tool, which aggregates features based on a specified attribute(s). We will be `dissolving' all of the attributes within one layer (the buffer output), so that the overlaps will combine. Run the dissolve tool with the buffer as the input. As can be seen on Figure \ref{2_dissolve}, this tool can be easily found with a quick search. Figure \ref{2_dissolved_output} shows the output, where polygons have been merged together so the overlaps no longer exist.

\begin{figure}[h]
  \centering
  \caption{Running the dissolve tool}
  \includegraphics[width=270px]{images/part2/volcano_buffer_dissolved.PNG}
  \label{2_dissolve}
\end{figure}

\pagebreak

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Output of the buffer tool on the volcano layer}
    \includegraphics[width=190px]{images/part2/volcano_buffer_output.PNG}
    \label{2_buffer_output}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Output of the dissolve tool on the buffered volcano layer}
    \includegraphics[width=180px]{images/part2/volcano_buffer_dissolved_output.PNG}
    \label{2_dissolved_output}
  \end{minipage}
\end{figure}

Let's see how many people fall within this `high danger' area around the volcanoes of Auckland. There are a few ways to achieve this - something you will find in working with desktop GIS applications is that there are often several ways to tackle a problem. We will use the select by location tool. Go to Selection $>$ Select by Location... (see Figure \ref{2_selectbylocation}), setting the target layer as that of the census, with the dissolved buffer you just created as the source layer. The spatial selection method will be intersect. Click apply, it should look like Figure \ref{2_selection_all}. 

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Selecting by location}
    \includegraphics[width=200px]{images/part2/selectbylocation.PNG}
    \label{2_selectbylocation}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Selection from initial select by location}
    \includegraphics[width=200px]{images/part2/selection_all.PNG}
    \label{2_selection_all}
  \end{minipage}
\end{figure}

That looks a little... off. The census units include offshore islands and the exclusive economic zone around NZ, which we don't really want to factor into our geoprocessing as no people will be full-time residents in these areas. Right-click on the census layer $>$ Open Attribute Table. Here we can see the tabular data that makes up this layer, with the `SHAPE' column containing the geometry, or where the row of data is represented spatially. 
\pagebreak

Following Figure \ref{2_selectbyattributes}, open up the Select by Attributes window. Here we can make a selection within the layer based on a condition(s). Our selection is going to be on the `LANDWATER\_NAME' column, and we want the value to equal to `Mainland'. Running this tool will select all rows that have the value `Mainland' on the specified column, so that we can isolate all areas that are on the mainland. Your map view should look like Figure  (note: make sure you have cleared selected features between steps)

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Select by attributes}
    \includegraphics[width=200px]{images/part2/selectbyattributes.PNG}
    \label{2_selectbyattributes}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Selection from select by attributes = mainland}
    \includegraphics[width=200px]{images/part2/selection_mainland.PNG}
    \label{2_selection_mainland}
  \end{minipage}
\end{figure}

Here we can see we have selected only the areas on land. We want to look at this data only, excluding everything that isn't mainland. Export this selection as its own layer by right-clicking on the census layer $>$ Data $>$ Export Data, leaving the settings as seen on Figure \ref{2_saveselected}. Run the same select by location as you did before, this time with the freshly exported layer as the target layer. The output should only include mainland layers (see Figure \ref{2_selection_mainland_buffer}).

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Saving the current census selection}
    \includegraphics[width=200px]{images/part2/saveselectedfeatures.PNG}
    \label{2_saveselected}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Selection by location of buffer intersecting with census mainland}
    \includegraphics[width=200px]{images/part2/selection_mainland_buffer.PNG}
    \label{2_selection_mainland_buffer}
  \end{minipage}
\end{figure}
\pagebreak

Let's take a look at exactly what this selection is showing. Open up the attribute table of the exported mainland census layer that you have just created a selection on. You can switch the table view to only show selected rows with the small button on the bottom left (see Figure \ref{2_viewattributetable}). Right-click on the column titled `C18\_CURPop' which is the current population of each area as of the 2018 census, then select statistics as per Figure \ref{2_viewattribute_statistics}. You should get a sum of around 280,000. This is the population within our high danger zone area! I encourage you to work out the population that is affected by each of the buffer layers we create. Census population and other demographic information are extremely important to geospatial analysis, so this process is important to be familiar with.

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.5\textwidth}
    \centering
    \caption{Viewing selected records on the attribute table}
    \includegraphics[width=250px]{images/part2/viewattributetable.PNG}
    \label{2_viewattributetable}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Finding the statistics for the selected column}
    \includegraphics[width=150px]{images/part2/viewattribute_statistics.PNG}
    \label{2_viewattribute_statistics}
  \end{minipage}
\end{figure}

Time to work out other areas of danger. I have defined the areas of danger as 1km, 2.5km and 10km for my analysis. For the purposes of this exercise, you can do whatever you like - I have defined mine arbitrarily. In reality, disaster risk maps like this would be developed with far more rigorous geoprocessing including road network access, underlying lithology, infrastructure pipelines etc. This lesson covers the basics of vector analysis, so we will not go further than these basic tools. All that being said, create two more buffers. Note that the step of manually running the dissolve tool is not necessary. Figure \ref{2_volcanobuffer_2} shows how the buffer tool can automatically dissolve when running.
\pagebreak

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.3\textwidth}
    \centering
    \caption{Buffer tool including a dissolve}
    \includegraphics[width=150px]{images/part2/volcano_buffer_2.PNG}
    \label{2_volcanobuffer_2}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.5\textwidth}
    \centering
    \caption{Feature to polygon tool on NZ coastline}
    \includegraphics[width=250px]{images/part2/featuretopolygon.PNG}
    \label{2_featuretopolygon}
  \end{minipage}
\end{figure}

The issue with these buffers is that they extend beyond the coastline, where no people will be impacted. We want to `clip' the buffers to the coastline of NZ so that the map will make more sense for the viewer. This is what we have the coastlines dataset for. This dataset is a line that wraps around the extent of the NZ mainland. In order to crop our buffers to it easily, we need to convert the line into a polygon that covers all of NZ. Run the Feature to Polygon tool (see Figure \ref{2_featuretopolygon}) on the data, then run the Clip tool on each buffer, with the buffers as the input features and the polygon you just created as the clip features (see Figure \ref{2_clip}).

\begin{figure}[h]
  \centering
  \caption{Running the clip tool on the buffers}
  \includegraphics[width=250px]{images/part2/clip.PNG}
  \label{2_clip}
\end{figure}

We can see that the Clip tool has cropped the buffer to the `mainland' of NZ. Figure \ref{2_allbuffers_noclip} shows my buffers before the clip with Figure \ref{2_allbuffers_clipped} showing the buffers after the clip (note that I changed the colours after processing). That is the last of the geoprocessing done, you should now be ready to make your map.\pagebreak

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{1\textwidth}
    \centering
    \caption{Buffers before clipping to coastline}
    \includegraphics[width=300px]{images/part2/allbuffers_noclip.PNG}
    \label{2_allbuffers_noclip}
  \end{minipage}

  \vspace{0.5cm}

  \begin{minipage}[b]{1\textwidth}
    \centering
    \caption{Buffers after clipping to coastline}
    \includegraphics[width=300px]{images/part2/allbuffers_clipped.PNG}
    \label{2_allbuffers_clipped}
  \end{minipage}
\end{figure}

I added some labels to each of the buffers, you can choose whatever you'd like. Follow the same cartography steps as lesson 1. Figure \ref{2_map} shows my final map for lesson 2. \pagebreak

\begin{figure}[h]
  \centering
  \caption{Example of a final map for lesson 2}
  \fbox{\includegraphics[width=400px]{images/part2/sophie_part2.png}}
  \label{2_map}
\end{figure}

\pagebreak
\section{Part 3: Raster Analysis}
\subsection{Preamble}
This section will cover basic raster analysis. We will be creating a flood risk map using raster data and a GIS technique called multi-criteria evaluation (MCE). MCE combines several criteria to create an output surface that accounts for each factor. MCE is ubiquitous in GIS, and is very important to understand. We will be using a basic normalisation technique to make things less complicated.\\

Imagine you have been tasked by the Southland District Council to produce a flood risk map for Rakiura/Stewart Island. The factors that they want included in assessing flood risk are the distance to roads, distance away from the coastline, distance away from rivers, and past data on rain in the area. They have also specified that they will not consider areas that are higher than 300m in elevation and areas that have higher than a 35\textdegree{} slope. The flood risk will thus be based on a combination of extreme rainfall events, storm surge, and accessibility in case of emergency.

\subsection{Data Overview}
This section builds familiarity with raster data. Some of the source data will be in vector form, but we will create raster `distance surface' layers from them. A Digital Elevation Model (DEM) will be used for slope and elevation. This is a raster layer that has z values for height, often captured using LiDAR. There will be river, road and coastline layers, often using the same data sources as previous steps - note that the cropping I have applied will be different so please use the layers in the appropriate folder. \\

I have provided a rainfall layer. This layer was processed from that listed below. I did some clipping and spatial interpolation, as well as low-pass filtering to make the layer more visually appealing and conform with the spatial resolution of the other layers. This geoprocessing is out of the scope of this lesson, although I will explain further in the instructions.

\begin{table}[h]
\begin{center}
    \begin{tabular}{ | m{4cm} | m{1cm}| m{3.5cm} | m{5cm} | m{1cm} | } 
    \hline
    \cellcolor{red!35!blue!33!green!33!}\textbf{Name/Description} & 
    \cellcolor{red!35!blue!33!green!33!}\textbf{Size} &
    \cellcolor{red!35!blue!33!green!33!}\textbf{Source} &
    \cellcolor{red!35!blue!33!green!33!}\textbf{Learning Objective(s)} &
    \cellcolor{red!35!blue!33!green!33!}\textbf{ID} \\
    \hline
    ArcMap basemap & N/A & ESRI (within ArcMap) & Cartography (context) & 10 \\
    \hline
    Invercargill DEM & 40MB & University of Otago School of Surveying & Geoprocessing & 30 \\
    \hline
    NZ coastlines (crop) & 1MB & LINZ & Geoprocessing & 22 \\
    \hline
    NZ road section geometry (crop) & 1MB & LINZ & Geoprocessing & 12 \\
    \hline
    NZ river centrelines & 1MB & LINZ & Geoprocessing & 31 \\
    \hline
    Average annual rainfall & 1MB & MfE & Geoprocessing & 32 \\
    \hline
    \end{tabular}
\end{center}
\caption{\label{tb_data_3}Data used for Part 3}
\end{table}

\pagebreak

\subsection{Instructions}
Load up all of the data listed. Adding the DEM might cause a `Create Pyramids' dialogue to pop-up (see Figure \ref{3_pyramids}). Rivers are the first set of data we will work with. This dataset is immense, and is far too fine-grained for our use case. We will define `major rivers' as rivers that are 3km or longer. To create a major rivers layer, right click on rivers $>$ Open Attribute Table then select the top left menu icon $>$ Add Field. Set this field to be of type `Double' with the name `length' (see Figure \ref{3_newattribute}). Right-click on the newly-created length column then select Calculate Geometry $>$ length. 

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Creating pyramids for processing DEMs}
    \includegraphics[width=180px]{images/part3/createpyramids.PNG}
    \label{3_pyramids}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Creating a new field within the attribute table}
    \includegraphics[width=180px]{images/part3/newattribute.PNG}
    \label{3_newattribute}
  \end{minipage}
\end{figure}

Next, we can use Select By Attributes, as seen in Figure \ref{3_majorrivers}, to select only rivers that have this new length field as greater than 3000 (m, depending on your Calculate Geometry settings). Here we are selecting all records of the table, under the condition that the `length' column is greater than 3000. Export your selection as a new layer under the name `major\_rivers', then add it to the map.

\begin{figure}[h]
  \centering
  \caption{Select by attributes - major rivers}
  \includegraphics[width=300px]{images/part3/selection_majorrivers.PNG}
  \label{3_majorrivers}
\end{figure}

Use the Feature to Polygon tool on the coastlines as with lesson 2. This polygon will be important as we will use it to limit all geoprocessing to its extent. We do this to ensure we are not wasting computation on processing things that we are not interested in, as well as making our lives easier as it essentially automatically clips all of the geoprocessing for us. Right click on Geoprocessing $>$ Environments, changing the Processing Extent and Raster Analysis settings as to Figure \ref{3_environments} - this will limit our analysis to the polygon created (Rakiura).
\pagebreak

\begin{figure}[h]
  \centering
  \caption{Environment settings}
  \includegraphics[width=200px]{images/part3/environments.PNG}
  \label{3_environments}
\end{figure}

The final pre-processing of data required is to create our slope layer. Slope is how steep a given piece of land is, which we can calculate from the DEM using the Slope tool (under Spatial Analyst). Figure \ref{3_slope} shows the running of the Slope tool, with the DEM as input. Make sure the output measurement is in degrees. \\

\begin{figure}[h]
  \centering
  \caption{Running the Slope tool}
  \includegraphics[width=320px]{images/part3/slope.PNG}
  \label{3_slope}
\end{figure}
\pagebreak

We have now pre-processed all the data. Before jumping in to the geoprocessing, let's have a think about what exactly we want to produce. We have been tasked with creating a flood risk map (see Section 4.1), and have been provided with the factors that need to be included. We can interpret these criteria as factors, where a risk can be higher or lower with different degrees of strength, and constraints, where risk is either high or low. We can work through the geoprocessing effectively by focussing on a single criterion at once, followed by combining them all as the MCE calculation. \\

\textbf{Factors}
\begin{itemize}
  \item Distance to road network, where higher distance equates to higher risk
  \item Distance to major rivers, where higher distance equates to lower risk
  \item Distance to coastline, where higher distance equates to lower risk
  \item Historical rainfall, where higher rainfall equates to higher risk
\end{itemize}
\textbf{Constraints}
\begin{itemize}
  \item Areas over 500m above sea level can be considered as no risk, regardless of other factors
  \item Hillslopes with slopes steeper than 35\textdegree{} can be considered as no risk, regardless of other factors \\
\end{itemize}

For factors, we can now produce distance rasters of each criterion in the MCE. Distance rasters are raster layers that have a value relating to the distance to a defined feature. We will produce distance rasters for each criterion (eg. rivers) so that we can include the values in our map algebra. Map algebra involves a set of calculations, in this case, for each pixel of a raster grid. Each pixel will have multiple values for each criterion, and a final MCE raster calculation will combine them all to assess the competing criteria. This can be a lot to take in, and I have no doubt a quick search on the internet will yield a better explanation of the intricacies of raster analysis and MCEs. Completing the following steps will help, so do not be put off if you do not understand everything yet! \\

All that being said, let's create some distance rasters. The Euclidean Distance tool performs an `as the crow flies' buffer of distance around a certain feature, outputting a distance raster where each pixel has a value that contains the euclidean distance to the certain feature. Run this tool on the coastline, major rivers and road network layers. The output distance raster should be restricted to the extent of Rakiura thanks to the Environments settings we changed earlier. Figure \ref{3_euclidean_coast} shows the Euclidean tool about to run on the coastline layer. Figure \ref{3_euclidean_road_output} shows the output distance raster for the road network layer.\\

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Running the Euclidean Distance tool}
    \includegraphics[width=250px]{images/part3/euclidean_coast.PNG}
    \label{3_euclidean_coast}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Distance raster for the road network layer}
    \includegraphics[width=150px]{images/part3/euclidean_road_output.PNG}
    \label{3_euclidean_road_output}
  \end{minipage}
\end{figure}
\pagebreak

Normalisation is a fundamental step in the MCE process. Let's say we have our rainfall data, measured in mm/year, and coastline distance data, measured in m. Comparing these two within a formula directly is useless, as they have vastly different units. We want to ignore the values of the units, focussing on the relative strength or weakness of each factor that the units measure. To do this, we will normalise the data in a defined range of values (in our case, 0 to 1, where 0 is undesirable and 1 is desirable). \\

In the real world, normalisation would be achieved through complex algebraic methods. For the purposes of this lesson, we will employ the most straightforward method we can - using minimum and maximum raster values. Equation 1 outlines the formula we will use, where the minimum value will be transferred to a 0 and the maximum and 1 - applying throughout the range of values within a raster dataset.

\begin{equation}
  \text{normalised layer} = \frac{[layer] - min}{max - min}
\end{equation}
\vspace{0.2cm}

We can access map algebra using the Raster Calculator tool. Figure \ref{3_river_normalising} shows my raster calculation for the major rivers distance raster. We can see that the maximum value is 7196 (0 d.p.), with the minimum being 0. Using the normalisation technique of Equation 1, we can normalise the entire layer with the min and max values. Figure \ref{3_river_normalising_output} shows the output of this raster calculation, where we can see the new range of values are close to 0 and 1.

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Normalising the major rivers layer}
    \includegraphics[width=230px]{images/part3/river_normalising.PNG}
    \label{3_river_normalising}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Output of normalising the major rivers layer}
    \includegraphics[width=180px]{images/part3/river_normalising_output.PNG}
    \label{3_river_normalising_output}
  \end{minipage}
\end{figure}

Normalise all of the distance surfaces using this method. As another example, Figure \ref{3_road_normalising} shows the equation for normalising the road network layer, with Figure \ref{3_road_normalising_output} showing the output. Note that you may need to perform a secondary calculation to reverse the polarity of the normalised distance surfaces. This is because for some layers, further away is more desirable (eg. rivers), while others further away is less desirable (eg. road network). This can be achieved by subtracting the normalised raster layer from 1 ($1-[\text{layer}]$), and can be applied at your discretion. 
\pagebreak

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Normalising the road network layer}
    \includegraphics[width=230px]{images/part3/road_normalising.PNG}
    \label{3_road_normalising}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Output of normalising the road network layer}
    \includegraphics[width=180px]{images/part3/road_normalising_output.PNG}
    \label{3_road_normalising_output}
  \end{minipage}
\end{figure}

As mentioned in the Data Overview (see Section 4.2), I have provided a copy of the rainfall layer for your use in this lesson. The rainfall layer is a bit too much of a challenge to work with for this lesson, so I have completed the geoprocessing required for you to use. This data was much coarser than the other data, meaning that each measurement was represented by a much higher geographical area than other datasets (ie. there were only about 30 measurements for the entirety of the island). To account for this, I resampled the rainfall data, where the cell size was interpolated and made smaller. I then clipped it to the island and ran some low-pass filters on the data to reduce the strength of the boundaries between measurements. This reduces the `gridding' effect of using coarse data with finer data, while not impacting the trend of rainfall over the island. You can simply load this data into your project and it should be ready for the final MCE! \\

We have now completed all of the geoprocessing for the factors in the MCE. Now we must find the constraints. Constraints are a bit easier to create as they are boolean, meaning either one state (desirable) or another (non-desirable). First, we will create a layer with the raster calculator that returns a boolean for those that are less than or equal to 35\textdegree{} in slope. Figure \ref{3_slope_35} shows how this would be entered as a raster calculation, with Figure \ref{3_slope_35_output} showing the output. The areas in black are 0, or the slope is too high for flooding to occur, with the grey areas being flat enough for water to pool and flood.
\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.5\textwidth}
    \centering
    \caption{Raster calculation to create constraint layer for slope}
    \includegraphics[width=230px]{images/part3/slope_35degorless.PNG}
    \label{3_slope_35}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Boolean constraint layer for slope}
    \includegraphics[width=150px]{images/part3/slope_35degorless_output.PNG}
    \label{3_slope_35_output}
  \end{minipage}
\end{figure} \pagebreak

The other constraint to consider is the elevation cutoff. The Southland District Council considers areas over 500m of elevation safe from flooding. This boolean raster can also be simply created using the Raster Calculator on the DEM. The equation can be seen on Figure \ref{3_elevation} with the corresponding output on Figure \ref{3_elevation_output}. \\

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.5\textwidth}
    \centering
    \caption{Raster calculation to create constraint layer for elevation}
    \includegraphics[width=200px]{images/part3/dem_500morless.PNG}
    \label{3_elevation}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Boolean constraint layer for elevation}
    \includegraphics[width=150px]{images/part3/dem_500morless_output.PNG}
    \label{3_elevation_output}
  \end{minipage}
\end{figure}

All of the geoprocessing for the layers included in the MCE calculation has been completed. We have normalised distance rasters for factors and boolean layers for constraints. A cool thing we can do in an MCE is assign weighting for each factor, meaning we can account for each factors relative importance in the MCE output. In our case, we can assign weightings based on how important a factor will be for increasing flood risk in an area. This would normally be provided by the stakeholder, but we can use whatever we like. I will assign 10\% to the distance to coasts (storm surge is not hugely influential), 20\% to rainfall, 40\% to roads (as access is very important in extreme weather events), with the final 30\% to rivers. \\

With these weightings, we can build the MCE calculation in the Raster Calculator. Each factor must be multiplied by its weighting then added to one another. These combined factors can be multiplied by the constraints, then the output will be the final MCE raster. I have written out formula in Equation 2, with Figure \ref{3_finalmce_calc} showing this formula in the raster calculator and Figure \ref{3_finalmce_output} showing the output. The following page shows each of the criterion layers, followed by the final map.\\
\begin{equation}
  (0.1*[coasts]+0.2*[rain]+0.4*[roads]+0.3*[rivers])*[elevation]*[slope]
\end{equation}
\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.5\textwidth}
    \centering
    \caption{Final MCE raster calculation}
    \includegraphics[width=230px]{images/part3/finalmce_calc.PNG}
    \label{3_finalmce_calc}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Final MCE raster}
    \includegraphics[width=130px]{images/part3/finalmce_output.PNG}
    \label{3_finalmce_output}
  \end{minipage}
\end{figure}
\pagebreak

\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Normalised coastline distance raster}
    \includegraphics[width=140px]{images/part3/final_criteria/criterion_coast.PNG}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Normalised rainfall raster}
    \includegraphics[width=140px]{images/part3/final_criteria/criterion_rain.PNG}
  \end{minipage}

  \vspace{1cm}

  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Normalised major rivers distance raster}
    \includegraphics[width=140px]{images/part3/final_criteria/criterion_rivers.PNG}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Normalised road network distance raster}
    \includegraphics[width=140px]{images/part3/final_criteria/criterion_roads.PNG}
  \end{minipage}

  \vspace{1cm}

  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Boolean 35\textdegree{} slope constraint layer}
    \includegraphics[width=140px]{images/part3/final_criteria/constraint_35deg.PNG}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \centering
    \caption{Boolean 500m elevation constraint layer}
    \includegraphics[width=140px]{images/part3/final_criteria/constraint_500m.PNG}
  \end{minipage}
\end{figure}

\newgeometry{}
\begin{figure}
  \centering
  \caption{Lesson 3 Final Map}
  \fbox{\includegraphics[width=450px]{images/part3/sophie_part3.png}}
  \label{3_final}
\end{figure}

\vspace{3cm}
\section{Conclusion}
Thank you very much for reading! I hope that these lessons serve as a good foundation in GISystems and Science to teach students. Please do not hesitate to contact me for more information or issues with these lessons, I am more than happy to share and tips or tricks that I didn't include here. \\

Thanks again, \\
Sophie Kolston (she/her)




\end{document}
